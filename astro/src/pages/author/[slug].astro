---
// src/pages/author/[slug].astro
import Layout from '../../layouts/Layout.astro';
import BlogPostCard from '../../components/BlogPostCard.astro';

export async function getStaticPaths() {
  const posts = await Astro.glob('../../pages/blog/*.md');
  
  const authorsSet = new Set(posts.map(post => post.frontmatter.author));
  
  function slugify(text) {
    return text
      .toString()
      .toLowerCase()
      .replace(/\s+/g, '-')
      .replace(/[^\w-]+/g, '')
      .replace(/--+/g, '-')
      .replace(/^-+/, '')
      .replace(/-+$/, '');
  }

  return Array.from(authorsSet).map(author => ({
    params: { slug: slugify(author) },
    props: { authorName: author, posts: posts.filter(post => post.frontmatter.author === author) },
  }));
}

const { authorName, posts } = Astro.props;

const title = `Posts by ${authorName} - Your SaaS Product Blog`;
const description = `Read all blog posts written by ${authorName} on our SaaS product blog.`;
---

<Layout title={title} description={description}>
  <div class="min-h-screen bg-base-100">
    <section class="py-16 sm:py-24">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-5xl font-extrabold mb-8 text-center">
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">
            Posts by {authorName}
          </span>
        </h1>
        <p class="text-xl text-center mb-12 text-base-content opacity-80 max-w-2xl mx-auto">
          Explore all the insightful articles written by {authorName}.
        </p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {posts.map((post) => (
            <BlogPostCard post={post.frontmatter} url={post.url} />
          ))}
        </div>
      </div>
    </section>
  </div>
</Layout>